# 🚀 Accounts 學生帳戶資料管理快速開始

## 📦 已建立的檔案

本次已為您建立以下完整的檔案：

```
✅ gas/accounts.js                          # GAS 後端（4個函數）
✅ src/api/accounts/index.js                # API 層（4個 API）
✅ src/store/modules/accounts.js            # Pinia Store（狀態管理）
✅ src/views/accounts/index.vue             # Vue 前端頁面
✅ src/router/index.js                      # 路由配置（已更新）
✅ Accounts功能說明文件.md                  # 詳細說明文件
```

---

## 🎯 功能概述

這是一個**讓學生填寫自己帳戶資料**的模組，基於 Single Fruit 模組改良而來。

### 🆚 主要差異

| 特性     | Single Fruit（水果編輯） | Accounts（帳戶管理）       |
| -------- | ------------------------ | -------------------------- |
| 選擇方式 | 下拉選單選擇水果         | 自動根據登入學號載入       |
| 可否切換 | ✅ 可選擇其他水果        | ❌ 只能查看自己的資料      |
| 唯讀欄位 | ❌ 無                    | ✅ 有（學號、姓名、班級）  |
| 欄位數量 | 4 個                     | 12 個                      |
| 驗證規則 | 簡單驗證                 | 複雜驗證（檢查碼、格式等） |
| 適用場景 | 管理員編輯任意資料       | 學生填寫自己的資料         |

### ✨ 核心功能

1. 🔐 **自動載入** - 根據登入學號自動載入該學生的資料
2. 👁️ **唯讀欄位** - 學號、姓名、班級座號無法修改
3. ✏️ **可編輯欄位** - 郵局帳戶、聯絡資料可以編輯
4. ✅ **前端即時驗證** - 郵局檢查碼(validatePost7)、身分證檢查碼(validateTaiwanID)等
5. 🔒 **確認機制** - 修改資料後自動取消確認勾選，必須重新確認才能儲存
6. 💾 **儲存變更** - 先驗證表單→檢查確認勾選→保存到 Google Spreadsheet
7. 🔄 **重置功能** - 放棄變更，恢復原始狀態（包括確認狀態）
8. 🔍 **修改偵測** - 即時顯示「已修改」或「未修改」（confirm 欄位不計入）
9. ⚠️ **離開提醒** - 未儲存時切換頁面會提醒
10. 🎨 **學校色彩** - 使用學校藍色主題，簡潔專業

---

## 🎯 立即使用步驟

### 1️⃣ 準備 Google Spreadsheet

#### 建立工作表

在您的 Google Spreadsheet 中建立名為 `accounts` 的工作表。

#### 設定欄位

第一列（標題列）應包含以下 12 個欄位：

```
stunum | name | classnum | officenum | accountnum | aownername | aownerid | aownerrelation | email | cellphone | confirm | remark
```

#### 匯入初始資料

範例格式：

```
stunum    name        classnum  officenum  accountnum  aownername  aownerid  aownerrelation  email            cellphone     confirm  remark
admin     系統管理員   40199                                                   本人           abc@123.com     0912345678    1
9000001   學生1       40103                                                   本人           student1@...    0912345678    1
9000002   學生2       40104                                                   父親           student2@...    0912345678    1
```

> 💡 **重要：** 請預先建立所有學生的基本資料（學號、姓名、班級座號），其他欄位可留空，由學生自行填寫。

---

### 2️⃣ 部署 GAS 後端

執行以下指令將新的 GAS 函數部署到 Google Apps Script：

```powershell
# 方法一：使用專案提供的部署腳本
.\gas.ps1

# 方法二：使用 clasp 指令
clasp push
```

> ⚠️ **注意：** 部署後請重新整理網頁，確保載入最新的後端函數。

---

### 3️⃣ 啟動前端開發伺服器

```powershell
# 安裝依賴（如果尚未安裝）
pnpm install

# 啟動開發伺服器
pnpm dev
```

---

### 4️⃣ 存取學生帳戶資料頁面

開啟瀏覽器，訪問以下網址：

```
http://localhost:你的埠號/accounts
```

或在應用程式中點擊左側選單的「學生帳戶資料」。

---

## 🎮 使用流程

### 步驟 1: 登入系統

使用您的學號登入系統。

### 步驟 2: 自動載入資料

系統會自動根據您的學號載入您的資料，您會看到：

- **學生基本資料區**（唯讀）
  - 學號
  - 學生姓名
  - 班級座號

### 步驟 3: 填寫郵局帳戶資料

在「郵局帳戶資料」區塊填寫：

- **立帳郵局局號** - 7位數字（例如：0001234）
- **郵局存簿帳號** - 7位數字（含檢查碼）
- **郵局帳號戶名** - 必須與存簿上的戶名完全相同
- **戶名身分證字號** - 格式：A123456789
- **戶名親屬關係** - 從下拉選單選擇（本人、父親、母親等）
- **備註** - 若親屬關係為「其他」，請在此說明

### 步驟 4: 填寫聯絡資料

在「聯絡資料」區塊填寫：

- **學生電子郵件** - 用於接收重要通知
- **學生手機號碼** - 09開頭的10位數字

### 步驟 5: 確認並儲存

1. **檢查所有填寫的資料**
2. **勾選「確認資料正確」核取方塊**
3. **點擊「儲存變更」按鈕**
4. 儲存成功後，狀態會變為「未修改」

> 💡 **重要：** 如果您修改任何欄位，確認核取方塊會自動取消勾選，您需要重新檢查並再次勾選才能儲存。

### 額外功能

- **重置按鈕** - 放棄所有變更，恢復到原始狀態
- **修改狀態** - 頁面會即時顯示「已修改」或「未修改」

---

## 🎨 介面說明

### 1. 頁面標題

顯示「學生帳戶資料管理」和簡要說明。

### 2. 學生基本資料卡片

- 顯示學號、姓名、班級座號（唯讀）
- 顯示「已修改」或「未修改」標籤

### 3. 郵局帳戶資料卡片

- 6 個欄位（局號、帳號、戶名、身分證、親屬關係、備註）
- 每個欄位下方有填寫提示

### 4. 聯絡資料卡片

- 電子郵件、手機號碼
- 確認資料正確核取方塊

### 5. 操作按鈕卡片

- 儲存變更、重置按鈕
- 未儲存提醒訊息

### 6. 使用說明卡片

- 填寫步驟說明
- 重要提醒事項

---

## 🔍 功能測試

### 測試 1: 自動載入資料

1. 登入系統
2. 開啟帳戶資料頁面
3. 檢查是否自動載入您的基本資料（學號、姓名、班級）

### 測試 2: 填寫和驗證

1. 填寫郵局局號（輸入非數字，檢查是否出現錯誤提示）
2. 填寫郵局帳號（輸入錯誤格式，檢查驗證）
3. 填寫身分證字號（測試格式驗證）
4. 填寫電子郵件（測試電子郵件驗證）
5. 填寫手機號碼（測試手機格式驗證）

### 測試 3: 儲存和重置

1. 修改某些資料
2. 觀察狀態標籤變為「已修改」
3. 點擊「儲存變更」
4. 確認儲存成功並變為「未修改」
5. 再次修改資料
6. 點擊「重置」按鈕
7. 確認資料恢復到儲存後的狀態

### 測試 4: 離開提醒

1. 修改資料但不儲存
2. 嘗試切換到其他頁面
3. 確認出現「確定要離開」的提醒對話框

### 測試 5: 前端檢查碼驗證

1. **郵局局號測試**

   - 輸入 7 位數字但檢查碼錯誤
   - 離開欄位，應顯示「局號檢查碼錯誤」

2. **郵局帳號測試**

   - 輸入 7 位數字但檢查碼錯誤
   - 離開欄位，應顯示「帳號檢查碼錯誤」

3. **身分證測試**
   - 輸入正確格式但檢查碼錯誤
   - 離開欄位，應顯示「身分證檢查碼錯誤」

### 測試 6: 確認機制

1. 填寫資料並勾選「確認資料正確」
2. 修改任一欄位（如 email）
3. 確認核取方塊自動取消勾選 ✅
4. 嘗試點擊「儲存變更」，應被擋下
5. 重新勾選確認，才能儲存成功 ✅

---

## 📂 檔案功能說明

### 🖥️ 後端層 (`gas/accounts.js`)

提供 4 個主要函數：

```javascript
getAccountByStudentNumber(stunum) // 根據學號取得帳戶資料
updateAccount(stunum, accountData) // 更新帳戶資料
validateAccountData(accountData) // 驗證資料有效性
getRelationshipOptions() // 取得親屬關係選項
```

**關鍵特性：**

- 使用學號定位資料
- 不允許修改學號
- 複雜驗證規則（郵局帳號檢查碼、身分證字號等）
- 親屬關係下拉選單選項

### 🌐 API 層 (`src/api/accounts/index.js`)

封裝 API 呼叫，使用方式：

```javascript
import { getAccountByStudentNumber, updateAccount, getRelationshipOptions } from "@/api/accounts"

// 取得帳戶資料
const account = await getAccountByStudentNumber("9000001")

// 更新資料
const result = await updateAccount("9000001", accountData)

// 取得親屬關係選項
const options = await getRelationshipOptions()
```

### 📦 狀態管理 (`src/store/modules/accounts.js`)

**核心狀態：**

- `relationshipOptions` - 親屬關係選項列表
- `editingAccount` - 當前編輯的資料
- `originalAccount` - 原始資料（用於重置和比對）
- `isModified` - 是否已修改（計算屬性）

**核心動作：**

- `fetchRelationshipOptions()` - 載入親屬關係選項
- `loadAccountData(stunum)` - 載入帳戶資料
- `saveAccount()` - 儲存變更
- `resetForm()` - 重置表單

### 🎨 前端頁面 (`src/views/accounts/index.vue`)

**核心功能：**

- 整合 User Store 取得登入學號
- 自動載入該學號的資料
- 唯讀欄位顯示（使用 el-descriptions）
- 可編輯欄位表單（使用 el-form）
- 複雜表單驗證規則
- 修改偵測和狀態顯示
- 三重未儲存保護（路由、刷新、操作）

---

## 🔄 欄位說明

### 唯讀欄位

| 欄位名稱 | 說明     | 資料來源       |
| -------- | -------- | -------------- |
| stunum   | 學號     | 登入時的學號   |
| name     | 學生姓名 | 預先建立的資料 |
| classnum | 班級座號 | 預先建立的資料 |

### 可編輯欄位（郵局帳戶資料）

| 欄位名稱       | 說明           | 格式/規則                          |
| -------------- | -------------- | ---------------------------------- |
| officenum      | 立帳郵局局號   | 7位數字                            |
| accountnum     | 郵局存簿帳號   | 7位數字（含檢查碼驗證）            |
| aownername     | 郵局帳號戶名   | 文字（必須與存簿完全相同）         |
| aownerid       | 戶名身分證字號 | A123456789 格式                    |
| aownerrelation | 戶名親屬關係   | 下拉選單（8個選項）                |
| remark         | 備註           | 文字（親屬關係為「其他」時須填寫） |

### 可編輯欄位（聯絡資料）

| 欄位名稱  | 說明         | 格式/規則            |
| --------- | ------------ | -------------------- |
| email     | 學生電子郵件 | 標準電子郵件格式     |
| cellphone | 學生手機號碼 | 09開頭的10位數字     |
| confirm   | 確認資料正確 | 核取方塊（必須勾選） |

---

## 💡 驗證規則說明

### 1. 郵局局號（officenum）

- **格式：** 7 位數字
- **範例：** `0001234`

### 2. 郵局帳號（accountnum）

- **格式：** 7 位數字
- **範例：** `1234567`
- **特殊驗證：** 最後一碼為檢查碼，系統會自動驗證

### 3. 身分證字號（aownerid）

- **格式：** 第一碼為大寫英文，第二碼為1或2，後面8碼為數字
- **範例：** `A123456789`

### 4. 電子郵件（email）

- **格式：** 標準電子郵件格式
- **範例：** `student@example.com`

### 5. 手機號碼（cellphone）

- **格式：** 09 開頭的 10 位數字
- **範例：** `0912345678`

---

## ⚠️ 常見問題

### Q: 為什麼看不到下拉選單選擇其他學生？

**A:** 基於安全性和隱私考量，學生只能查看和編輯自己的資料。系統會自動根據您登入的學號載入對應的資料。

### Q: 學號、姓名、班級座號為什麼無法修改？

**A:** 這些是基本資料，應由系統管理員統一管理，學生不應自行修改。

### Q: 前端驗證顯示檢查碼錯誤怎麼辦？

**A:**

**郵局局號/帳號：**

1. 請仔細核對郵局存簿上的號碼
2. 確認輸入的是完整的 7 位數字
3. 若確認無誤但仍顯示錯誤，請洽郵局確認號碼是否正確

**身分證字號：**

1. 確認格式：1個大寫英文字母 + 1或2 + 8個數字
2. 檢查是否有輸入錯誤
3. 若確認無誤但仍顯示錯誤，請檢查證件上的號碼

### Q: 如果找不到我的資料怎麼辦？

**A:**

1. 確認您已正確登入
2. 確認系統管理員已在 Google Spreadsheet 中建立您的基本資料
3. 確認工作表名稱為 `accounts`
4. 若仍無法載入，請聯絡系統管理員

### Q: 親屬關係選擇「其他」時該怎麼做？

**A:** 請在「備註」欄位中說明實際的親屬關係，例如：「兄長」、「姊姊」等。

### Q: 為什麼修改資料後確認核取方塊會自動取消？

**A:** 這是為了確保您有重新檢查修改後的資料。任何欄位修改後，系統會自動取消確認勾選，提醒您再次確認資料正確性後才能儲存。

### Q: 為什麼勾選確認後按鈕還是不能按？

**A:** 可能的原因：

1. 表單有驗證錯誤（檢查紅色錯誤訊息）
2. 資料沒有修改（沒有需要儲存的變更）
3. 系統正在儲存中（請稍候）

### Q: 資料儲存在哪裡？

**A:** 所有資料都儲存在 Google Spreadsheet 的 `accounts` 工作表中。

---

## 🎓 進階學習

### 想要深入了解？

1. **閱讀詳細文件** - `Accounts功能說明文件.md`
2. **研究程式碼** - 查看各檔案中的註解
3. **對比差異** - 比較 Single Fruit 和 Accounts 的實作差異
4. **自己實作** - 參考文件建立類似的模組（如：家長資料、成績查詢等）

### 學習重點

- 🎯 **User Store 整合** - 如何取得登入使用者資訊
- 🔐 **資料權限控制** - 只能查看自己的資料
- 📝 **唯讀與可編輯欄位** - 分離不同權限的欄位
- ✅ **前端驗證函數** - validatePost7 和 validateTaiwanID 的實作
- 🔒 **確認機制設計** - watch 監聽、自動取消、isModified 邏輯
- 💬 **錯誤訊息設計** - 簡短明確的錯誤提示
- 🎨 **學校色彩主題** - 使用品牌色彩提升視覺效果
- 📱 **UI/UX 優化** - 登出按鈕、導航欄設計
- 🧪 **驗證策略** - 前後端驗證分工
- 🎨 **分區顯示** - 使用不同組件展示不同類型的資料

---

## 📚 相關資源

- **Accounts功能說明文件.md** - 本模組詳細技術文件
- **SingleFruit功能說明文件.md** - 單一編輯模組範例
- **Fruits功能說明文件.md** - 列表 CRUD 範例
- **Vue 3 文件** - https://vuejs.org/
- **Pinia 文件** - https://pinia.vuejs.org/
- **Element Plus 文件** - https://element-plus.org/

---

## 🎉 完成！

恭喜您！現在您已經擁有一個完整且專業的學生帳戶資料管理系統：

### ✨ 系統特色

- ✅ **安全性** - 學生只能查看和編輯自己的資料
- ✅ **前端即時驗證** - validatePost7 和 validateTaiwanID 檢查碼驗證
- ✅ **確認機制** - 自動取消勾選，確保使用者重新確認
- ✅ **友善介面** - 清楚的區域劃分和填寫說明
- ✅ **學校品牌** - 使用學校藍色主題
- ✅ **修改保護** - 未儲存變更時的多重提醒
- ✅ **簡短錯誤訊息** - 明確告知問題所在
- ✅ **明顯登出按鈕** - 學生容易找到

### 📚 您已學會

- ✅ 如何實作前端檢查碼驗證
- ✅ 如何設計確認機制（watch + 自動取消）
- ✅ 如何正確處理 isModified 邏輯
- ✅ 如何加入品牌色彩
- ✅ 如何優化 UI/UX（登出按鈕、導航欄）
- ✅ 如何設計前後端驗證分工

### 💡 您可以

- ✅ 讓學生填寫自己的郵局帳戶資料
- ✅ 參考此範例建立其他學生自填資料的功能
- ✅ 學習如何整合 User Store 和資料權限控制
- ✅ 套用相同的設計模式到其他專案

**祝您使用順利！** 🚀
